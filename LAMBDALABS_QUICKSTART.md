# Lambda Labs Quick Reference

## ðŸ†• First Time Setup (New Instance)

Your files are in: `/home/ubuntu/audiograft/SurgViVQA-Audio`

### Step 1: Run Setup Script (~10 min)
```bash
# SSH into Lambda Labs
ssh ubuntu@YOUR_IP

cd ~/audiograft/SurgViVQA-Audio

# Run one-time setup (auto-detects current directory)
bash setup_lambdalabs_venv.sh
```

This will:
- Create venv at `$HOME/venvs/surg-audio` (persistent)
- Install PyTorch, transformers, whisper, etc.
- Verify all dependencies

### Step 2: Extract Frames (~2 min)
```bash
# After downloading frames_002-001.zip to the instance
cd ~/audiograft/SurgViVQA-Audio
unzip frames_002-001.zip -d dataset/frames/
```

### Step 3: Generate Audio (~1 min)
```bash
# Activate venv
source ~/venvs/surg-audio/bin/activate

# Generate audio for both test sets
python generate_audio_subset.py --input test_set/in_002-001.jsonl --output audio/in_002-001
python generate_audio_subset.py --input test_set/out_002-001.jsonl --output audio/out_002-001
```

### Step 4: Verify Setup
```bash
python verify_setup.py \
    --test_file test_set/in_002-001.jsonl \
    --frames_dir dataset/frames \
    --audio_dir audio/in_002-001
# Should show: âœ“ SETUP VERIFIED
```

### Step 5: Run Experiments ðŸš€
```bash
bash run_all_baselines.sh
# Takes ~1-2 hours
```

---

## ðŸ”„ Instance Restart

If you stop and restart the Lambda Labs instance:

### Quick Start (2 seconds)
```bash
# SSH in
ssh ubuntu@YOUR_IP

# Navigate
cd ~/audiograft/SurgViVQA-Audio

# Activate venv (ONLY STEP NEEDED!)
source ~/venvs/surg-audio/bin/activate

# Run experiments
bash run_all_baselines.sh
```

**That's it!** Venv, frames, and audio persist.

---

## ðŸ“¥ Download Results

```bash
# === ON YOUR MAC ===
# After experiments finish
scp -r ubuntu@YOUR_IP:~/audiograft/SurgViVQA-Audio/results/ ./results/

# Check what you got
ls -lh results/
```

---

## ðŸ†˜ Common Issues

### "ModuleNotFoundError: No module named 'edge_tts'"
**Fix**: You forgot to activate the venv!
```bash
source ~/venvs/surg-audio/bin/activate
```

### "Audio directory doesn't exist"
**Fix**: Generate audio first
```bash
python generate_audio_subset.py --input test_set/in_002-001.jsonl --output audio/in_002-001
```

### "Frame not found"
**Fix**: Extract frames
```bash
unzip frames_002-001.zip -d dataset/frames/
```

---

## ðŸ’° Cost Tracking

**Typical Lambda Labs GPU pricing (varies by GPU type)**

| Action | Time | Example Cost |
|--------|------|--------------|
| First-time setup | ~15 min | ~$0.10-0.30 |
| Run all baselines | ~2 hours | ~$1.20-3.60 |
| **Total first run** | ~2.5 hours | **~$1.30-3.90** |

**Stop instance immediately after downloading results!**

---

## ðŸ“‹ File Structure on Lambda Labs

```
/home/ubuntu/audiograft/SurgViVQA-Audio/
â”œâ”€â”€ baselines/
â”‚   â”œâ”€â”€ baseline1_text_image.py
â”‚   â”œâ”€â”€ baseline2_audio_image.py
â”‚   â”œâ”€â”€ baseline3_asr_pipeline.py
â”‚   â””â”€â”€ utils.py
â”œâ”€â”€ test_set/
â”‚   â”œâ”€â”€ in_002-001.jsonl
â”‚   â””â”€â”€ out_002-001.jsonl
â”œâ”€â”€ dataset/frames/002-001/        # Downloaded from zip
â”œâ”€â”€ audio/                          # Generated by script
â”‚   â”œâ”€â”€ in_002-001/
â”‚   â””â”€â”€ out_002-001/
â”œâ”€â”€ results/                        # Created by baselines
â””â”€â”€ setup_lambdalabs_venv.sh       # Setup script

/home/ubuntu/venvs/surg-audio/     # Virtual environment (persistent)
```

---

## ðŸŽ¯ One-Command Workflow

### New Instance
```bash
cd ~/audiograft/SurgViVQA-Audio && \
bash setup_lambdalabs_venv.sh && \
source ~/venvs/surg-audio/bin/activate && \
unzip frames_002-001.zip -d dataset/frames/ && \
python generate_audio_subset.py --input test_set/in_002-001.jsonl --output audio/in_002-001 && \
python generate_audio_subset.py --input test_set/out_002-001.jsonl --output audio/out_002-001 && \
bash run_all_baselines.sh
```

### Restart Instance
```bash
cd ~/audiograft/SurgViVQA-Audio && \
source ~/venvs/surg-audio/bin/activate && \
bash run_all_baselines.sh
```

---

## ðŸ’¡ Pro Tips

1. **Always activate venv first** - `source ~/venvs/surg-audio/bin/activate`
2. **Stop instance immediately after downloading results** - Don't waste money
3. **Frames persist** - Never need to re-extract
4. **Venv persists** - Never need to reinstall packages
5. **Use tmux/screen** - Keep processes running if SSH disconnects

---

## ðŸ“ž Help Commands

```bash
# Check if venv exists
ls -la ~/venvs/surg-audio

# Check what Python you're using
which python

# Check if packages installed
pip list | grep transformers

# Check GPU
nvidia-smi

# Check frames
ls dataset/frames/002-001/ | wc -l  # Should be 25998

# Check audio
ls audio/in_002-001/ | wc -l  # Should be 50

# Check disk usage
du -sh ~/audiograft/SurgViVQA-Audio/*
```
